<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4th encounter solver</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // ボタンのクリック時の処理を追加
            document.querySelectorAll('.num-set-button').forEach(function(button) {
                button.addEventListener('click', function() {
                    toggleSelection(button);
                    updateCorrespondingSlot(button);
                    updateFilteredResults();
                });
            });
        });
    
        // ボタンの選択状態を切り替える関数
        function toggleSelection(button) {
            const slot = button.closest('.slot');
            // ボタンが属するスロットの全てのボタンからselectedクラスを削除
            slot.querySelectorAll('.num-set-button').forEach(function(btn) {
                if (btn !== button) {
                    btn.classList.remove('selected');
                }
            });
    
            // 選択されたボタンにselectedクラスを追加
            button.classList.toggle('selected');
        }
    
        // 対応するスロットの表記を更新する関数
        function updateCorrespondingSlot(button) {
            const slotClass = button.classList[1];
            let resultText = '';
            switch (button.innerText) {
                case '球体':
                    resultText = '(0a, 0b)';
                    break;
                case '立方体':
                    resultText = '(4a, 4b)';
                    break;
                case '三角錐':
                    resultText = '(3a, 3b)';
                    break;
                case '円柱':
                    resultText = '(0a, 4a)';
                    break;
                case '円錐':
                    resultText = '(0a, 3a)';
                    break;
                case '三角柱':
                    resultText = '(3a, 4a)';
                    break;
            }
    
            if (slotClass.includes('num-set-button-D')) {
                document.getElementById('result-D2').innerText = resultText;
            } else if (slotClass.includes('num-set-button-E')) {
                document.getElementById('result-E2').innerText = resultText;
            } else if (slotClass.includes('num-set-button-F')) {
                document.getElementById('result-F2').innerText = resultText;
            }
        }
    
        // 裏スロットの値を取得する関数
        function getSelectedValue(slotClass) {
            const selectedButton = document.querySelector(`.num-set-button-${slotClass}.selected`);
            return selectedButton ? selectedButton.innerText : null;
        }
    
        // 表スロットの対応を取得する関数
        function getCorrespondingText(buttonText) {
            switch (buttonText) {
                case '球体': return '(0a, 0b)';
                case '立方体': return '(4a, 4b)';
                case '三角錐': return '(3a, 3b)';
                case '円柱': return '(0a, 4a)';
                case '円錐': return '(0a, 3a)';
                case '三角柱': return '(3a, 4a)';
                default: return '';
            }
        }
    
        // フィルタリングされた結果を更新する関数
        function updateFilteredResults() {
            updateResultForSlot('A', 'result-D2', 'num-set-button-D');
            updateResultForSlot('B', 'result-E2', 'num-set-button-E');
            updateResultForSlot('C', 'result-F2', 'num-set-button-F');
    
            updateNeededAndUnneededNumbers('result-D2', 'result-D3');
            updateNeededAndUnneededNumbers('result-E2', 'result-E3');
            updateNeededAndUnneededNumbers('result-F2', 'result-F3');
            
            updateAnatomySlot();
            updateResultForD4();
            updateResultForE4();
            updateResultForF4();
        }
    
        // 指定されたスロットの結果を更新する関数
        function updateResultForSlot(slotClass, resultId, buttonClass) {
            const resultElement = document.getElementById(resultId);
            const values = {
                '▲': '3a',
                '■': '4a',
                '●': '0a'
            };
    
            const selectedValue = getSelectedValue(slotClass);
            const filteredValues = Object.values(values).filter(value => value !== values[selectedValue]);
    
            const correspondingButton = document.querySelector(`.${buttonClass}.selected`);
            const correspondingText = correspondingButton ? getCorrespondingText(correspondingButton.innerText) : '';
    
            const resultText = selectedValue ? `(${filteredValues[0]}, ${filteredValues[1]})` : '';
            resultElement.innerText = correspondingText ? `${correspondingText}\n${resultText}` : resultText;
        }
    
        // 表示されている2組の数字を比較して必要な数字と不要な数字を表示する関数
        function updateNeededAndUnneededNumbers(resultId, targetId) {
            const resultElement = document.getElementById(resultId).innerText;
            const targetElement = document.getElementById(targetId);
    
            const lines = resultElement.split('\n');
            if (lines.length < 2) {
                targetElement.innerText = '';
                return;
            }
    
            const [firstLine, secondLine] = lines;
            const firstNumbers = firstLine.match(/\d[a-z]/g);
            const secondNumbers = secondLine.match(/\d[a-z]/g);
    
            const neededNumbers = secondNumbers.filter(num => !firstNumbers.includes(num));
            const unneededNumbers = firstNumbers.filter(num => !secondNumbers.includes(num));
    
            let resultText = '';
            if (neededNumbers.length > 0 || unneededNumbers.length > 0) {
                resultText += `${unneededNumbers.join('と')}が不要、${neededNumbers.join('と')}が必要`;
            }
    
            targetElement.innerText = resultText;
        }
    
        // 解剖スロットを更新する関数
        function updateAnatomySlot() {
            const resultD3 = document.getElementById('result-D3').innerText;
            const resultE3 = document.getElementById('result-E3').innerText;
            const resultF3 = document.getElementById('result-F3').innerText;

            const unwantedD3 = resultD3.match(/\d[a-z]/g) || [];
            const unwantedE3 = resultE3.match(/\d[a-z]/g) || [];
            const unwantedF3 = resultF3.match(/\d[a-z]/g) || [];

            let resultText = '';

            // 「不要」文字の最初のものだけを使う
            if (unwantedD3.length > 0) {
                resultText += `Dで${unwantedD3[0]}を解剖`;
            }
            if (unwantedE3.length > 0) {
                if (resultText) resultText += '、';
                resultText += `Eで${unwantedE3[0]}を解剖`;
            } else if (unwantedF3.length > 0) {
                if (resultText) resultText += '、';
                resultText += `Fで${unwantedF3[0]}を解剖`;
            }

            document.getElementById('result-Anatomy').innerText = resultText;
        }
        // D4スロットを更新する関数
        function updateResultForD4() {
            const resultD2 = document.getElementById('result-D2').innerText;
            const selectedButtonD1 = document.querySelector('.num-set-button-D.selected');

            if (!selectedButtonD1) return;

            let [firstPart, secondPart] = resultD2.split('\n')[0].match(/\d[a-z]/g);
            const anatomyResult = document.getElementById('result-Anatomy').innerText;
            const unwantedX = anatomyResult.match(/(\d[a-z])/g) || [];
            const neededY = anatomyResult.match(/(\d[a-z])/g) || [];

            if (unwantedX.length > 0 && neededY.length > 0) {
                if (firstPart === unwantedX[0]) firstPart = neededY[0];
                else if (secondPart === unwantedX[0]) secondPart = neededY[0];
            }

            document.getElementById('result-D4').innerText = `(${firstPart}, ${secondPart})`;
        }

        // E4スロットを更新する関数
        function updateResultForE4() {
            const selectedButtonE1 = document.querySelector('.num-set-button-E.selected');
            const anatomyResult = document.getElementById('result-Anatomy').innerText;

            if (!selectedButtonE1) return;

            let [firstPart, secondPart] = getCorrespondingText(selectedButtonE1.innerText).match(/\d[a-z]/g);
            const unwantedX = anatomyResult.match(/(\d[a-z])/g) || [];
            const neededY = anatomyResult.match(/(\d[a-z])/g) || [];

            if (anatomyResult.includes('Eで') && unwantedX.length > 0 && neededY.length > 0) {
                if (firstPart === unwantedX[0]) firstPart = neededY[0];
                else if (secondPart === unwantedX[0]) secondPart = neededY[0];
            }

            document.getElementById('result-E4').innerText = `(${firstPart}, ${secondPart})`;
        }

        // F4スロットを更新する関数
        function updateResultForF4() {
            const selectedButtonF1 = document.querySelector('.num-set-button-F.selected');
            const anatomyResult = document.getElementById('result-Anatomy').innerText;

            if (!selectedButtonF1) return;

            let [firstPart, secondPart] = getCorrespondingText(selectedButtonF1.innerText).match(/\d[a-z]/g);
            const unwantedX = anatomyResult.match(/(\d[a-z])/g) || [];
            const neededY = anatomyResult.match(/(\d[a-z])/g) || [];

            if (anatomyResult.includes('Fで') && unwantedX.length > 0 && neededY.length > 0) {
                if (firstPart === unwantedX[0]) firstPart = neededY[0];
                else if (secondPart === unwantedX[0]) secondPart = neededY[0];
            }

            document.getElementById('result-F4').innerText = `(${firstPart}, ${secondPart})`;
        }
    
        // 入力をクリアする関数
        function clearSelection() {
            document.querySelectorAll('.selected').forEach(function(button) {
                button.classList.remove('selected');
            });
            document.getElementById('result-D2').innerText = '';
            document.getElementById('result-E2').innerText = '';
            document.getElementById('result-F2').innerText = '';
            document.getElementById('result-D3').innerText = '';
            document.getElementById('result-E3').innerText = '';
            document.getElementById('result-F3').innerText = '';
            document.getElementById('result-D4').innerText = '';
            document.getElementById('result-E4').innerText = '';
            document.getElementById('result-F4').innerText = '';
            document.getElementById('result-Anatomy').innerText = '';
        }
    </script>
    
    
    <style>
        h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .slot {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* スロット間の余白を追加 */
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, auto);
            grid-gap: 5px; /* ボタン間の余白を追加 */
        }
        .selected {
            background-color: lightblue; /* 選択されたボタンの背景色 */
        }
        .slot:nth-of-type(n+4) {
            margin-top: 10px; /* スロット表D1、表E1、表F1の縦方向の余白を追加 */
        }
    </style>
</head>
<body>
    <h1>4th encounter solver</h1>
    <div>
        <div class="slot">
            <h2>裏A：</h2>
            <div>
                <button class="num-set-button num-set-button-A">▲</button>
                <button class="num-set-button num-set-button-A">■</button>
                <button class="num-set-button num-set-button-A">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏B：</h2>
            <div>
                <button class="num-set-button num-set-button-B">▲</button>
                <button class="num-set-button num-set-button-B">■</button>
                <button class="num-set-button num-set-button-B">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏C：</h2>
            <div>
                <button class="num-set-button num-set-button-C">▲</button>
                <button class="num-set-button num-set-button-C">■</button>
                <button class="num-set-button num-set-button-C">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>表D1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-D">球体</button>
                <button class="num-set-button num-set-button-D">立方体</button>
                <button class="num-set-button num-set-button-D">三角錐</button>
                <button class="num-set-button num-set-button-D">円柱</button>
                <button class="num-set-button num-set-button-D">円錐</button>
                <button class="num-set-button num-set-button-D">三角柱</button>
            </div>
        </div>    
        <div class="slot">
            <h2>表E1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-E">球体</button>
                <button class="num-set-button num-set-button-E">立方体</button>
                <button class="num-set-button num-set-button-E">三角錐</button>
                <button class="num-set-button num-set-button-E">円柱</button>
                <button class="num-set-button num-set-button-E">円錐</button>
                <button class="num-set-button num-set-button-E">三角柱</button>
            </div>
        </div>
        <div class="slot">
            <h2>表F1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-F">球体</button>
                <button class="num-set-button num-set-button-F">立方体</button>
                <button class="num-set-button num-set-button-F">三角錐</button>
                <button class="num-set-button num-set-button-F">円柱</button>
                <button class="num-set-button num-set-button-F">円錐</button>
                <button class="num-set-button num-set-button-F">三角柱</button>
            </div>
        </div>
        <div class="slot">
            <h2>表D2：</h2>
            <div id="result-D2"></div>
        </div>
        <div class="slot">
            <h2>表E2：</h2>
            <div id="result-E2"></div>
        </div>
        <div class="slot">
            <h2>表F2：</h2>
            <div id="result-F2"></div>
        </div>
        <div class="slot">
            <h2>表D3：</h2>
            <div id="result-D3"></div>
        </div>
        <div class="slot">
            <h2>表E3：</h2>
            <div id="result-E3"></div>
        </div>
        <div class="slot">
            <h2>表F3：</h2>
            <div id="result-F3"></div>
        </div>
        <div class="slot">
            <h2>解剖1：</h2>
            <div id="result-Anatomy"></div>
        </div>
        <div class="slot">
            <h2>表D4：</h2>
            <div id="result-D4"></div>
        </div>
        <div class="slot">
            <h2>表E4：</h2>
            <div id="result-E4"></div>
        </div>
        <div class="slot">
            <h2>表F4：</h2>
            <div id="result-F4"></div>
        </div>
        <button onclick="clearSelection()">入力クリア</button>
    </div>
</body>
</html>
