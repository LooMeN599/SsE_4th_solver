<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4th encounter solver</title>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.num-set-button').forEach(function(button) {
            button.addEventListener('click', function() {
                toggleSelection(button);
                updateFilteredResults();
            });
        });
    });

        // ボタンの選択状態を切り替える関数
        function toggleSelection(button) {
            const slot = button.closest('.slot');
            // ボタンが属するスロットの全てのボタンからselectedクラスを削除
            slot.querySelectorAll('.num-set-button').forEach(function(btn) {
                if (btn !== button) {
                    btn.classList.remove('selected');
                }
            });

            // 選択されたボタンにselectedクラスを追加
            button.classList.toggle('selected');
        }

        // 裏スロットの値を取得する関数
        function getSelectedValue(slotClass) {
            const selectedButton = document.querySelector(`.num-set-button-${slotClass}.selected`);
            return selectedButton ? selectedButton.innerText : null;
        }

        // 表スロットの対応を取得する関数
        function getCorrespondingText(buttonText) {
            switch (buttonText) {
                case '球体': return '(0a, 0b)';
                case '立方体': return '(4a, 4b)';
                case '三角錐': return '(3a, 3b)';
                case '円柱': return '(0a, 4a)';
                case '円錐': return '(0a, 3a)';
                case '三角柱': return '(3a, 4a)';
                default: return '';
            }
        }

        // 裏スロットの対応を取得する関数
        function getCorrespondingValues(slotClass, buttonClass) {
            const selectedValue = getSelectedValue(slotClass);
            if (!selectedValue) return '';

            const correspondingButton = document.querySelector(`.${buttonClass}.selected`);
            if (!correspondingButton) return '';

            const correspondingText = getCorrespondingText(correspondingButton.innerText);
            const values = correspondingText.match(/\d[a-z]/g);
            const filteredValues = values.filter(value => value !== correspondingText[selectedValue]);
            return `(${filteredValues[0]}, ${filteredValues[1]})`;
        }

        // フィルタリングされた結果を更新する関数
        function updateFilteredResults() {
            const resultD2 = getCorrespondingValues('A', 'num-set-button-D');
            const resultE2 = getCorrespondingValues('B', 'num-set-button-E');
            const resultF2 = getCorrespondingValues('C', 'num-set-button-F');

            updateNeededAndUnneededNumbers(resultD2, 'result-D3');
            updateNeededAndUnneededNumbers(resultE2, 'result-E3');
            updateNeededAndUnneededNumbers(resultF2, 'result-F3');
        }

        // 表示されている2組の数字を比較して必要な数字と不要な数字を表示する関数
        function updateNeededAndUnneededNumbers(result, targetId) {
            const targetElement = document.getElementById(targetId);

            const lines = result.split('\n');
            if (lines.length < 2) {
                targetElement.innerText = '';
                return;
            }

            const [firstLine, secondLine] = lines;
            const firstNumbers = firstLine.match(/\d[a-z]/g);
            const secondNumbers = secondLine.match(/\d[a-z]/g);

            const neededNumbers = secondNumbers.filter(num => !firstNumbers.includes(num));
            const unneededNumbers = firstNumbers.filter(num => !secondNumbers.includes(num));

            let resultText = '';
            if (neededNumbers.length > 0 || unneededNumbers.length > 0) {
                resultText += `${unneededNumbers.join('と')}が不要、${neededNumbers.join('と')}が必要`;
            }

            // 数字を記号に変換
            resultText = convertText(resultText);

            targetElement.innerText = resultText;
        }

        // 数字を記号に変換する関数
        function convertText(text) {
            if (!text) return ''; // 空の場合は空文字を返す
            return text.replace(/0a|0b/g, '●')
                    .replace(/3a|3b/g, '▲')
                    .replace(/4a|4b/g, '■');
        }

        // 入力をクリアする関数
        function clearSelection() {
            document.querySelectorAll('.selected').forEach(function(button) {
                button.classList.remove('selected');
            });
            document.getElementById('result-D3').innerText = '';
            document.getElementById('result-E3').innerText = '';
            document.getElementById('result-F3').innerText = '';
            document.getElementById('result-PostAnatomy').innerText = ''; //
        }
    </script>
    
    
    <style>
        h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
        }
        .slot {
            display: flex;
            align-items: center;
            margin-bottom: 10px; /* スロット間の余白を追加 */
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, auto);
            grid-gap: 5px; /* ボタン間の余白を追加 */
        }
        .selected {
            background-color: lightblue; /* 選択されたボタンの背景色 */
        }
        .slot:nth-of-type(n+4) {
            margin-top: 10px; /* スロット表D1、表E1、表F1の縦方向の余白を追加 */
        }

        #result-D2, #result-E2, #result-F2 {
            display: none; /* 非表示にする */
        }
    </style>
</head>
<body>
    <h1>4th encounter solver</h1>
    <div>
        <div class="slot">
            <h2>裏A：</h2>
            <div>
                <button class="num-set-button num-set-button-A">▲</button>
                <button class="num-set-button num-set-button-A">■</button>
                <button class="num-set-button num-set-button-A">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏B：</h2>
            <div>
                <button class="num-set-button num-set-button-B">▲</button>
                <button class="num-set-button num-set-button-B">■</button>
                <button class="num-set-button num-set-button-B">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>裏C：</h2>
            <div>
                <button class="num-set-button num-set-button-C">▲</button>
                <button class="num-set-button num-set-button-C">■</button>
                <button class="num-set-button num-set-button-C">●</button>
            </div>
        </div>
        <div class="slot">
            <h2>表D1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-D">球体</button>
                <button class="num-set-button num-set-button-D">立方体</button>
                <button class="num-set-button num-set-button-D">三角錐</button>
                <button class="num-set-button num-set-button-D">円柱</button>
                <button class="num-set-button num-set-button-D">円錐</button>
                <button class="num-set-button num-set-button-D">三角柱</button>
            </div>
        </div>    
        <div class="slot">
            <h2>表E1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-E">球体</button>
                <button class="num-set-button num-set-button-E">立方体</button>
                <button class="num-set-button num-set-button-E">三角錐</button>
                <button class="num-set-button num-set-button-E">円柱</button>
                <button class="num-set-button num-set-button-E">円錐</button>
                <button class="num-set-button num-set-button-E">三角柱</button>
            </div>
        </div>
        <div class="slot">
            <h2>表F1：</h2>
            <div class="button-grid">
                <button class="num-set-button num-set-button-F">球体</button>
                <button class="num-set-button num-set-button-F">立方体</button>
                <button class="num-set-button num-set-button-F">三角錐</button>
                <button class="num-set-button num-set-button-F">円柱</button>
                <button class="num-set-button num-set-button-F">円錐</button>
                <button class="num-set-button num-set-button-F">三角柱</button>
            </div>
        </div>
        <div class="slot" style="display: none;">
            <h2>表D2：</h2>
            <div id="result-D2"></div>
        </div>
        <div class="slot" style="display: none;">
            <h2>表E2：</h2>
            <div id="result-E2"></div>
        </div>
        <div class="slot" style="display: none;">
            <h2>表F2：</h2>
            <div id="result-F2"></div>
        </div>
        <div class="slot">
            <h2>表D3：</h2>
            <div id="result-D3"></div>
        </div>
        <div class="slot">
            <h2>表E3：</h2>
            <div id="result-E3"></div>
        </div>
        <div class="slot">
            <h2>表F3：</h2>
            <div id="result-F3"></div>
        </div>
        <button onclick="clearSelection()">入力クリア</button>
    </div>
</body>
</html>
